<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>webchannel test</title>
    </head>
    <body>
        <h1>webchannel test</h1>
        <section id="content"></section>
        <input style="display:none;" id="message" type="text"/>
        <div id="grid-0-0" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-0-1" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-0-2" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-0-3" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-0-4" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-0-5" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <br/>
        <div id="grid-1-0" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-1-1" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-1-2" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-1-3" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-1-4" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-1-5" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <br/>
        <div id="grid-2-0" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-2-1" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-2-2" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-2-3" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-2-4" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-2-5" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <br/>
        <div id="grid-2-0" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-2-1" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-2-2" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-2-3" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-2-4" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-2-5" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <br/>
        <div id="grid-3-0" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-3-1" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-3-2" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-3-3" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-3-4" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-3-5" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <br/>
        <div id="grid-4-0" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-4-1" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-4-2" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-4-3" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-4-4" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-4-5" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <br/>
        <div id="grid-5-0" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-5-1" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-5-2" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-5-3" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-5-4" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <div id="grid-5-5" style="display:inline-block; width:20px; height:20px; background:yellow; border: 1px; margin: 1px; padding: 1px;"></div>
        <br/>
        
        <script src="http://www.google.com/jsapi"></script>
        <script>google.load("jquery", "1.3")</script>
        <script src="http://jquery-json.googlecode.com/files/jquery.json-2.2.min.js"></script>
        <script src="jquery.websockets.js"></script>
        <script>        
            var ws = $.websocket("ws://127.0.0.1:9003/", {
                open: function() {
                    ws.send('message', { op: "subscribe", channel: "grid-*" });
                    setTimeout("pulse();", 1000);
                },
                message: function(e) {
                    //$('#content').append(e.originalEvent.data + '<br>') 
                    var obj = JSON.parse(e.originalEvent.data);
                    var id = obj.channel;
                    $("#"+id).toggle();
                }, 
                events: {
                    message: function(e) { 
                        $('#content').append(e + '<br>') 
                    }
                }
            });
            $('#message').change(function(){
                ws.send('message', this.value);
                this.value = '';
            });
                        
            function pulse() {
                console.log("pulse");
                var x = Math.floor(Math.random()*6);
                var y = Math.floor(Math.random()*6);
                ws.send('message', { op: "publish", channel: "grid-" + x + "-" + y, message: "pulse"});
                setTimeout("pulse();", 1000);
            }
            
            
        </script>
    </body>
</html>
